{"remainingRequest":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/src/views/user/staff.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/src/views/user/staff.vue","mtime":1579004431098},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/cache-loader/dist/cjs.js","mtime":1574737719973},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/babel-loader/lib/index.js","mtime":1574737707076},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/ts-loader/index.js","mtime":1574737715182},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/cache-loader/dist/cjs.js","mtime":1574737719973},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/vue-loader/lib/index.js","mtime":1581426799590}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCmltcG9ydCB7IHJlZiwgb25Nb3VudGVkfSBmcm9tICdAdnVlL2NvbXBvc2l0aW9uLWFwaSc7CmltcG9ydCB7IHVzZVJPTVNMaXN0IH0gZnJvbSAnQC91dGlscy9yb21zJzsKaW1wb3J0IHt1c2VMb2FkaW5nLCB1c2VTZWFyY2gsIHVzZUNvbmZpcm19IGZyb20gJ3dlYi10b29sa2l0L3NyYy9zZXJ2aWNlJzsKaW1wb3J0IHtwb3N0U2VydmljZX0gZnJvbSAnd2ViLXRvb2xraXQvc3JjL2Nhc2UtbWFpbic7CmltcG9ydCB7ZGVlcENsb25lfSBmcm9tICd3ZWItdG9vbGtpdC9zcmMvdXRpbHMnOwoKaW1wb3J0IHsgdXJsTWFwIH0gZnJvbSAnQC9jb25maWcnOwppbXBvcnQgeyBNZXNzYWdlIH0gZnJvbSAnZWxlbWVudC11aSc7CmltcG9ydCB7dXNlQWRtaW5pc3RyYXRpb25MaXN0fSBmcm9tICdAL3V0aWxzL3VzZS1saXN0JzsKaW1wb3J0IHtBZG1pbmlzdHJhdGlvbiwgSVVzZXJ9IGZyb20gJ0AvdHlwZXMvYmVhbnMnOwppbXBvcnQge0VsRm9ybX0gZnJvbSAnZWxlbWVudC11aS90eXBlcy9mb3JtJzsKZXhwb3J0IGRlZmF1bHQgewogIHNldHVwKCkgewogICAgY29uc3QgbG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBbbGlzdCwgcXVlcnldID0gdXNlUk9NU0xpc3QoJ3N0YWZmJyk7CiAgICBjb25zdCB7IGFyZWFMb2FkaW5nLCBhZGRyZXNzLCBsaXN0czogeyBwcm92aW5jZUxpc3QsIGNpdHlMaXN0LCBhcmVhTGlzdCB9LCBxdWVyeVByb3ZpbmNlTGlzdCB9ID0gdXNlQWRtaW5pc3RyYXRpb25MaXN0KHsgYXV0b1NlbGVjdDogZmFsc2UgfSk7CiAgICBjb25zdCBtb2RhbCA9IHJlZjxhbnk+KHsKICAgICAgdmlzaWJsZTogZmFsc2UsCiAgICAgIGRhdGE6IHt9LAogICAgfSk7CiAgICBjb25zdCBmb3JtID0gcmVmPEVsRm9ybXxudWxsPihudWxsKTsKICAgIGNvbnN0IG1vZGFsMiA9IHJlZjxhbnk+KHsKICAgICAgdmlzaWJsZTogZmFsc2UsCiAgICAgIGRhdGE6IHsKICAgICAgICBwcm92aW5jZTogbnVsbCwKICAgICAgICBjaXR5OiBudWxsLAogICAgICAgIGFyZWE6IG51bGwsCiAgICAgIH0sCiAgICB9KTsKCiAgICBmdW5jdGlvbiB2YWxpZGF0b3IocnVsZTogYW55LCB2YWx1ZTogc3RyaW5nLCBjYWxsYmFjazogRnVuY3Rpb24pIHsKICAgICAgaWYgKCF2YWx1ZSAmJiAobW9kYWwudmFsdWUuZGF0YS5wd2QgIT09ICcnICkpIHsKICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoJ+ivt+WGjeasoei+k+WFpeWvhueggScpKTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSAhPT0gbW9kYWwudmFsdWUuZGF0YS5wd2QpIHsKICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoJ+S4pOasoei+k+WFpeWvhueggeS4jeS4gOiHtCEnKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2FsbGJhY2soKTsKICAgICAgfQogICAgfQogICAgY29uc3QgcXVlcnlNYW51YWxseSA9IGFzeW5jICgpID0+IHsKICAgICAgY29uc3QgeyBwcm92aW5jZSwgY2l0eSwgYXJlYSB9ID0gYWRkcmVzcy52YWx1ZTsKICAgICAgYXdhaXQgcXVlcnkoewogICAgICAgIHByb3ZpbmNlQ29kZTogcHJvdmluY2UgPyBwcm92aW5jZS5jb2RlIDogbnVsbCwKICAgICAgICBjaXR5Q29kZTogY2l0eSA/IGNpdHkuY29kZSA6IG51bGwsCiAgICAgICAgYXJlYUNvZGU6IGFyZWEgPyBhcmVhLmNvZGUgOiBudWxsLAogICAgICAgIG5lZWRBbGw6IHRydWUsCiAgICAgIH0pOwogICAgfTsKICAgIGNvbnN0IFtrZXl3b3JkcywgZmlsdGVyZWRdID0gdXNlU2VhcmNoKGxpc3QsIHsKICAgICAgaW5jbHVkZVByb3BzOiBbJ25hbWUnLCAncGhvbmUnLCAndXNlcm5hbWUnXSwKICAgIH0pOwogICAgY29uc3Qgc2hvd0Zvcm0gPSBhc3luYyAoc3RhZmY/OiBJVXNlcikgPT4gewogICAgICBjb25zdCBpbml0Rm9ybSA9IHsKICAgICAgICB1c2VybmFtZTogdW5kZWZpbmVkLAogICAgICAgIG5hbWU6IHVuZGVmaW5lZCwKICAgICAgICBwaG9uZTogdW5kZWZpbmVkLAogICAgICAgIHB3ZDogJycsCiAgICAgICAgcHdkQ2hlY2s6ICcnLAogICAgICB9OwogICAgICBpZiAoc3RhZmYpIHsKICAgICAgICBzdGFmZi5wd2QgPSAnJzsKICAgICAgICAoc3RhZmYgYXMgYW55KS5wd2RDaGVjayA9ICcnOwogICAgICB9CiAgICAgIG1vZGFsLnZhbHVlLmRhdGEgPSBzdGFmZiA/IGRlZXBDbG9uZShzdGFmZikgOiBpbml0Rm9ybTsKICAgICAgbW9kYWwudmFsdWUudmlzaWJsZSA9IHRydWU7CiAgICAgIGlmIChmb3JtLnZhbHVlKSB7IChmb3JtLnZhbHVlIGFzIEVsRm9ybSkuY2xlYXJWYWxpZGF0ZSgpOyB9CiAgICB9OwogICAgYXN5bmMgZnVuY3Rpb24gdXBkYXRlKCkgewogICAgICBjb25zdCB2YWxpZCA9IGF3YWl0IChmb3JtLnZhbHVlIGFzIEVsRm9ybSkudmFsaWRhdGUoKTsKICAgICAgaWYgKCF2YWxpZCkgeyByZXR1cm4gOyB9CiAgICAgIGNvbnN0IHsgaWQsIG5hbWUsIHBob25lLCBwd2QsIHVzZXJuYW1lIH0gPSBtb2RhbC52YWx1ZS5kYXRhIGFzIElVc2VyOwogICAgICBjb25zdCB1cmwgPSBpZCA/IHVybE1hcC5yb21zX3N0YWZmX3VwZGF0ZS51cmwgOiB1cmxNYXAucm9tc19zdGFmZl9jcmVhdGUudXJsOwogICAgICBhd2FpdCBwb3N0U2VydmljZSh1cmwsIHsKICAgICAgICBpZCwgbmFtZSwgcGhvbmUsIHB3ZCwgdXNlcm5hbWUsCiAgICAgIH0pOwogICAgICBtb2RhbC52YWx1ZS52aXNpYmxlID0gZmFsc2U7CiAgICAgIGF3YWl0IHF1ZXJ5TWFudWFsbHkoKTsKICAgICAgTWVzc2FnZS5zdWNjZXNzKGAke2lkID8gJ+S/ruaUuScgOiAn5re75YqgJ33miJDlip9gKTsKICAgIH0KICAgIGNvbnN0IHJlbW92ZSA9IGFzeW5jIChzdGFmZjogSVVzZXIpID0+IHsKICAgICAgYXdhaXQgcG9zdFNlcnZpY2UodXJsTWFwLnJvbXNfc3RhZmZfZGVsLnVybCwgewogICAgICAgIGlkOiBzdGFmZi5pZCwKICAgICAgICBvZmY6IDAsCiAgICAgIH0pOwogICAgICBhd2FpdCBxdWVyeU1hbnVhbGx5KCk7CiAgICAgIE1lc3NhZ2Uuc3VjY2Vzcygn5Yig6Zmk5oiQ5YqfJyk7CiAgICB9OwogICAgY29uc3QgZnJlZXplID0gYXN5bmMgKHN0YWZmOiBJVXNlciwgb2ZmOiBudW1iZXIpID0+IHsKICAgICAgYXdhaXQgcG9zdFNlcnZpY2UodXJsTWFwLnJvbXNfc3RhZmZfZGVsLnVybCwgewogICAgICAgIGlkOiBzdGFmZi5pZCwKICAgICAgICBvZmYsCiAgICAgIH0pOwogICAgICBhd2FpdCBxdWVyeU1hbnVhbGx5KCk7CiAgICAgIE1lc3NhZ2Uuc3VjY2VzcyhgJHtvZmYgPT09IDEgPyAn5Ya757uTJyA6ICfop6PlhrsnfeaIkOWKn2ApOwogICAgfTsKICAgIGNvbnN0IHVwZGF0ZVJlbGF0ZUFyZWEgPSBhc3luYyAoc3RhZmY6IElVc2VyKSA9PiB7CiAgICAgIGNvbnN0IHsgcHJvdmluY2UsIGNpdHksIGFyZWEgfSA9IG1vZGFsMi52YWx1ZS5kYXRhOwogICAgICBpZiAoIXByb3ZpbmNlKSB7CiAgICAgICAgTWVzc2FnZS5lcnJvcign6K+36YCJ5oup55yB5Lu9Jyk7CiAgICAgICAgcmV0dXJuIDsKICAgICAgfQogICAgICBjb25zdCB7ZGF0YToge3JlbGF0aW9ufX0gPSBhd2FpdCBwb3N0U2VydmljZSh1cmxNYXAucm9tc19zdGFmZl9yZWxhdGlvbl9hcmVhc19hZGQudXJsLCB7CiAgICAgICAgcHJvdmluY2VDb2RlOiBwcm92aW5jZSEuY29kZSwKICAgICAgICBjaXR5Q29kZTogY2l0eSAmJiBjaXR5LmNvZGUsCiAgICAgICAgYXJlYUNvZGU6IGFyZWEgJiYgYXJlYS5jb2RlLAogICAgICAgIHN0YWZmSWQ6IHN0YWZmLmlkLAogICAgICB9KTsKICAgICAgc3RhZmYuZXh0ZW5kLmFyZWFSZWxhdGlvbnMgPSBzdGFmZi5leHRlbmQuYXJlYVJlbGF0aW9ucyB8fCBbXTsKICAgICAgc3RhZmYuZXh0ZW5kLmFyZWFSZWxhdGlvbnMucHVzaChyZWxhdGlvbik7CiAgICAgIG1vZGFsMi52YWx1ZVsndmlzaWJsZScgKyBzdGFmZi5pZF0gPSBmYWxzZTsKICAgICAgTWVzc2FnZS5zdWNjZXNzKCfmt7vliqDmiJDlip8nKTsKICAgIH07CiAgICBjb25zdCByZW1vdmVSZWxhdGVkQXJlYSA9IGFzeW5jIChzdGFmZjogSVVzZXIsIHJlbGF0ZWRBcmVhOiBSZWxhdGVkQXJlYSkgPT4gewogICAgICBhd2FpdCBwb3N0U2VydmljZSh1cmxNYXAucm9tc19zdGFmZl9yZWxhdGlvbl9hcmVhc19kZWwudXJsLCB7CiAgICAgICAgaWQ6IHJlbGF0ZWRBcmVhLmlkLAogICAgICB9KTsKICAgICAgY29uc3QgYXJlYVJlbGF0aW9ucyA9IHN0YWZmLmV4dGVuZC5hcmVhUmVsYXRpb25zOwogICAgICBhcmVhUmVsYXRpb25zLnNwbGljZShhcmVhUmVsYXRpb25zLmluZGV4T2YocmVsYXRlZEFyZWEpLCAxKTsKICAgICAgTWVzc2FnZS5zdWNjZXNzKCfliKDpmaTmiJDlip8nKTsKICAgIH07CiAgICBvbk1vdW50ZWQodXNlTG9hZGluZyhsb2FkaW5nLCBhc3luYyAoKSA9PiB7CiAgICAgIGF3YWl0IFByb21pc2UuYWxsKFsKICAgICAgICBxdWVyeVByb3ZpbmNlTGlzdCgpLAogICAgICAgIHF1ZXJ5KHsKICAgICAgICAgIG5lZWRBbGw6IHRydWUsCiAgICAgICAgfSksCiAgICAgIF0pOwogICAgfSkpOwogICAgcmV0dXJuIHsKICAgICAgbG9hZGluZywKICAgICAgYXJlYUxvYWRpbmcsCiAgICAgIGFkZHJlc3MsCiAgICAgIHByb3ZpbmNlTGlzdCwKICAgICAgY2l0eUxpc3QsCiAgICAgIGFyZWFMaXN0LAogICAgICBxdWVyeU1hbnVhbGx5OiB1c2VMb2FkaW5nKGxvYWRpbmcsIHF1ZXJ5TWFudWFsbHkpLAogICAgICBrZXl3b3JkcywKICAgICAgZmlsdGVyZWQsCiAgICAgIHNob3dGb3JtLAogICAgICB1cGRhdGVSZWxhdGVBcmVhLAogICAgICByZW1vdmVSZWxhdGVkQXJlYTogdXNlQ29uZmlybSgn56Gu6K6k5Yig6Zmk6K+l6LSf6LSj5Yy65Z+f77yfJywgdXNlTG9hZGluZyhsb2FkaW5nLCByZW1vdmVSZWxhdGVkQXJlYSkpLAogICAgICByZW1vdmU6IHVzZUNvbmZpcm0oJ+ehruiupOWIoOmZpOivpee7tOaKpOS6uuWRmO+8nycsIHVzZUxvYWRpbmcobG9hZGluZywgcmVtb3ZlKSksCiAgICAgIGZyZWV6ZTogdXNlTG9hZGluZyhsb2FkaW5nLCBmcmVlemUpLAogICAgICB2YWxpZGF0b3IsIG1vZGFsLCBmb3JtLCBtb2RhbDIsCiAgICAgIHVwZGF0ZTogdXNlTG9hZGluZyhsb2FkaW5nLCB1cGRhdGUpLAogICAgfTsKICB9LAp9OwppbnRlcmZhY2UgUmVsYXRlZEFyZWEgewogIGlkOiBudW1iZXI7CiAgY2l0eTogQWRtaW5pc3RyYXRpb247CiAgcHJvdmluY2U/OiBBZG1pbmlzdHJhdGlvbjsKICBhcmVhPzogQWRtaW5pc3RyYXRpb247Cn0K"},{"version":3,"sources":["staff.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwFA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"staff.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\n  <div v-loading=\"loading\">\n    <div class=\"flex align-center between\">\n      <div class=\"flex little-space\">\n        <el-button type=\"success\" @click=\"showForm()\">添加维护人员</el-button>\n        <el-select value-key=\"name\" clearable filterable placeholder=\"请选择省份\" v-model=\"address.province\">\n          <el-option v-for=\"item of provinceList\" :key=\"item.code\" :label=\"item.name\" :value=\"item\"/>\n        </el-select>\n        <el-select value-key=\"name\" clearable filterable placeholder=\"请选择城市\" v-model=\"address.city\">\n          <el-option v-for=\"item of cityList\" :key=\"item.code\" :label=\"item.name\" :value=\"item\"/>\n        </el-select>\n        <el-select value-key=\"name\" clearable filterable placeholder=\"请选择地区\" :loading=\"areaLoading\" v-model=\"address.area\">\n          <el-option v-for=\"item of areaList\" :key=\"item.code\" :label=\"item.name\" :value=\"item\"/>\n        </el-select>\n        <el-button type=\"primary\" @click=\"queryManually\">查询</el-button>\n      </div>\n      <el-input class=\"search-bar\" v-model=\"keywords\" placeholder=\"请输入搜索内容\" clearable/>\n    </div>\n    <lkt-table :data=\"filtered\">\n      <el-table-column type=\"expand\">\n        <div slot-scope=\"{ row }\" class=\"flex column center\">\n          <div class=\"flex align-center\">\n            <h3 style=\"margin-right: 1rem\">{{ row.name }}-负责区域</h3>\n            <el-popover\n              @hide=\"modal2.data={province:null, city:null, area:null}\"\n              v-model=\"modal2['visible'+row.id]\"\n              placement=\"top\"\n              title=\"增加负责区域\"\n              trigger=\"click\">\n              <el-button slot=\"reference\" circle size=\"mini\" icon=\"el-icon-plus\" type=\"success\"/>\n              <div style=\"text-align: center\">\n                <el-form label-width=\"80px\" label-position=\"left\" class=\"flex column between\" style=\"width: 100%;margin: 0 auto\">\n                  <el-form-item label=\"省市区：\" :rules=\"{ required: true, trigger: 'none' }\">\n                    <pca-select :value=\"modal2.data\" />\n                  </el-form-item>\n                </el-form>\n                <el-button type=\"primary\" @click=\"updateRelateArea(row)\">增加</el-button>\n              </div>\n            </el-popover>\n          </div>\n          <el-table :data=\"row.extend.areaRelations\" stripe>\n            <el-table-column label=\"省份\" prop=\"province.name\" align=\"center\" sortable/>\n            <el-table-column label=\"城市\" prop=\"city.name\" align=\"center\" sortable/>\n            <el-table-column label=\"地区\" prop=\"area.name\" align=\"center\" sortable/>\n            <el-table-column label=\"操作\" align=\"center\">\n              <el-button slot-scope=\"{ row: relatedArea }\" type=\"danger\" size=\"mini\" @click=\"removeRelatedArea(row, relatedArea)\">删除</el-button>\n            </el-table-column>\n          </el-table>\n        </div>\n      </el-table-column>\n      <el-table-column sortable label=\"账户登录名\" prop=\"username\"/>\n      <el-table-column sortable label=\"姓名\" prop=\"name\"/>\n      <el-table-column sortable label=\"手机号\" prop=\"phone\"/>\n      <el-table-column label=\"操作\" align=\"center\">\n        <div class=\"flex center wrap little-space\" slot-scope=\"{ row }\">\n          <el-button size=\"mini\" type=\"primary\" @click=\"showForm(row)\">修改</el-button>\n          <el-button v-if=\"row.off === 0\" size=\"mini\" type=\"warning\" @click=\"freeze(row, 1)\">冻结</el-button>\n          <el-button v-else size=\"mini\" type=\"success\" @click=\"freeze(row, 2)\">解冻</el-button>\n          <el-button size=\"mini\" type=\"danger\" @click=\"remove(row)\">删除</el-button>\n        </div>\n      </el-table-column>\n    </lkt-table>\n    <kit-dialog-simple\n      :modal=\"modal\"\n      :confirm=\"update\"\n      width=\"40%\">\n      <div slot=\"title\">{{modal.data.id? '修改':'添加'}}维护人员</div>\n      <el-form ref=\"form\" label-position=\"left\" label-width=\"120px\" :model=\"modal.data\">\n        <el-form-item label=\"账户登录名：\" prop=\"username\" :rules=\"{ required: true, message: '请填写账户登录名' }\">\n          <el-input clearable v-model=\"modal.data.username\" placeholder=\"请输入账户登录名\" />\n        </el-form-item>\n        <el-form-item :label=\"!modal.data.id ? '密码：' : '修改密码：'\" prop=\"pwd\" :rules=\"[{ required: !modal.data.id, message: '请填写密码' }, { type: 'string', min: 6, message: '密码长度不能小于6位', trigger: 'blur'}]\">\n          <el-input clearable v-model=\"modal.data.pwd\" type=\"password\" />\n        </el-form-item>\n        <el-form-item label=\"确认密码：\" prop=\"pwdCheck\" :rules=\"{ required: !modal.data.id, validator: validator }\">\n          <el-input clearable v-model=\"modal.data.pwdCheck\" type=\"password\" />\n        </el-form-item>\n        <el-form-item label=\"姓名：\" prop=\"name\" :rules=\"{ required: true, message: '请填写姓名' }\">\n          <el-input clearable v-model=\"modal.data.name\" placeholder=\"请输入姓名\"/>\n        </el-form-item>\n        <el-form-item label=\"手机：\" prop=\"phone\" :rules=\"{ required: true, message: '请输入手机号' }\">\n          <el-input clearable v-model=\"modal.data.phone\" placeholder=\"请输入手机号\"/>\n        </el-form-item>\n      </el-form>\n    </kit-dialog-simple>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { ref, onMounted} from '@vue/composition-api';\nimport { useROMSList } from '@/utils/roms';\nimport {useLoading, useSearch, useConfirm} from 'web-toolkit/src/service';\nimport {postService} from 'web-toolkit/src/case-main';\nimport {deepClone} from 'web-toolkit/src/utils';\n\nimport { urlMap } from '@/config';\nimport { Message } from 'element-ui';\nimport {useAdministrationList} from '@/utils/use-list';\nimport {Administration, IUser} from '@/types/beans';\nimport {ElForm} from 'element-ui/types/form';\nexport default {\n  setup() {\n    const loading = ref(false);\n    const [list, query] = useROMSList('staff');\n    const { areaLoading, address, lists: { provinceList, cityList, areaList }, queryProvinceList } = useAdministrationList({ autoSelect: false });\n    const modal = ref<any>({\n      visible: false,\n      data: {},\n    });\n    const form = ref<ElForm|null>(null);\n    const modal2 = ref<any>({\n      visible: false,\n      data: {\n        province: null,\n        city: null,\n        area: null,\n      },\n    });\n\n    function validator(rule: any, value: string, callback: Function) {\n      if (!value && (modal.value.data.pwd !== '' )) {\n        callback(new Error('请再次输入密码'));\n      } else if (value !== modal.value.data.pwd) {\n        callback(new Error('两次输入密码不一致!'));\n      } else {\n        callback();\n      }\n    }\n    const queryManually = async () => {\n      const { province, city, area } = address.value;\n      await query({\n        provinceCode: province ? province.code : null,\n        cityCode: city ? city.code : null,\n        areaCode: area ? area.code : null,\n        needAll: true,\n      });\n    };\n    const [keywords, filtered] = useSearch(list, {\n      includeProps: ['name', 'phone', 'username'],\n    });\n    const showForm = async (staff?: IUser) => {\n      const initForm = {\n        username: undefined,\n        name: undefined,\n        phone: undefined,\n        pwd: '',\n        pwdCheck: '',\n      };\n      if (staff) {\n        staff.pwd = '';\n        (staff as any).pwdCheck = '';\n      }\n      modal.value.data = staff ? deepClone(staff) : initForm;\n      modal.value.visible = true;\n      if (form.value) { (form.value as ElForm).clearValidate(); }\n    };\n    async function update() {\n      const valid = await (form.value as ElForm).validate();\n      if (!valid) { return ; }\n      const { id, name, phone, pwd, username } = modal.value.data as IUser;\n      const url = id ? urlMap.roms_staff_update.url : urlMap.roms_staff_create.url;\n      await postService(url, {\n        id, name, phone, pwd, username,\n      });\n      modal.value.visible = false;\n      await queryManually();\n      Message.success(`${id ? '修改' : '添加'}成功`);\n    }\n    const remove = async (staff: IUser) => {\n      await postService(urlMap.roms_staff_del.url, {\n        id: staff.id,\n        off: 0,\n      });\n      await queryManually();\n      Message.success('删除成功');\n    };\n    const freeze = async (staff: IUser, off: number) => {\n      await postService(urlMap.roms_staff_del.url, {\n        id: staff.id,\n        off,\n      });\n      await queryManually();\n      Message.success(`${off === 1 ? '冻结' : '解冻'}成功`);\n    };\n    const updateRelateArea = async (staff: IUser) => {\n      const { province, city, area } = modal2.value.data;\n      if (!province) {\n        Message.error('请选择省份');\n        return ;\n      }\n      const {data: {relation}} = await postService(urlMap.roms_staff_relation_areas_add.url, {\n        provinceCode: province!.code,\n        cityCode: city && city.code,\n        areaCode: area && area.code,\n        staffId: staff.id,\n      });\n      staff.extend.areaRelations = staff.extend.areaRelations || [];\n      staff.extend.areaRelations.push(relation);\n      modal2.value['visible' + staff.id] = false;\n      Message.success('添加成功');\n    };\n    const removeRelatedArea = async (staff: IUser, relatedArea: RelatedArea) => {\n      await postService(urlMap.roms_staff_relation_areas_del.url, {\n        id: relatedArea.id,\n      });\n      const areaRelations = staff.extend.areaRelations;\n      areaRelations.splice(areaRelations.indexOf(relatedArea), 1);\n      Message.success('删除成功');\n    };\n    onMounted(useLoading(loading, async () => {\n      await Promise.all([\n        queryProvinceList(),\n        query({\n          needAll: true,\n        }),\n      ]);\n    }));\n    return {\n      loading,\n      areaLoading,\n      address,\n      provinceList,\n      cityList,\n      areaList,\n      queryManually: useLoading(loading, queryManually),\n      keywords,\n      filtered,\n      showForm,\n      updateRelateArea,\n      removeRelatedArea: useConfirm('确认删除该负责区域？', useLoading(loading, removeRelatedArea)),\n      remove: useConfirm('确认删除该维护人员？', useLoading(loading, remove)),\n      freeze: useLoading(loading, freeze),\n      validator, modal, form, modal2,\n      update: useLoading(loading, update),\n    };\n  },\n};\ninterface RelatedArea {\n  id: number;\n  city: Administration;\n  province?: Administration;\n  area?: Administration;\n}\n</script>\n\n"]}]}