{"remainingRequest":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/src/views/user/user.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/src/views/user/user.vue","mtime":1579004435392},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/cache-loader/dist/cjs.js","mtime":1574737719973},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/babel-loader/lib/index.js","mtime":1574737707076},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/ts-loader/index.js","mtime":1574737715182},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/cache-loader/dist/cjs.js","mtime":1574737719973},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/vue-loader/lib/index.js","mtime":1581426799590}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKaW1wb3J0IHsgcmVmLCBvbk1vdW50ZWQsIGNyZWF0ZUNvbXBvbmVudCB9IGZyb20gJ0B2dWUvY29tcG9zaXRpb24tYXBpJzsKaW1wb3J0IHsgTWVzc2FnZSB9IGZyb20gJ2VsZW1lbnQtdWknOwppbXBvcnQgeyB1c2VTZWFyY2gsIHVzZUxvYWRpbmcsIHVzZUNvbmZpcm0gfSBmcm9tICd3ZWItdG9vbGtpdC9zcmMvc2VydmljZSc7CmltcG9ydCB7IGRlZXBDbG9uZSB9IGZyb20gJ3dlYi10b29sa2l0L3NyYy91dGlscyc7CmltcG9ydCB7cG9zdFNlcnZpY2UsIHN0b3JlVXNlckluZm99IGZyb20gJ3dlYi10b29sa2l0L3NyYy9jYXNlLW1haW4nOwppbXBvcnQge3VzZUxpc3R9IGZyb20gJ0AvdXRpbHMvdXNlLWxpc3QnOwppbXBvcnQge0lVc2VyfSBmcm9tICdAL3R5cGVzL2JlYW5zJzsKaW1wb3J0IHt1cmxNYXB9IGZyb20gJ0AvY29uZmlnJzsKaW1wb3J0IHtFbEZvcm19IGZyb20gJ2VsZW1lbnQtdWkvdHlwZXMvZm9ybSc7CmV4cG9ydCBkZWZhdWx0IGNyZWF0ZUNvbXBvbmVudCh7CiAgbmFtZTogJ1VzZXInLAogIHNldHVwKCkgewogICAgY29uc3QgbG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBbbGlzdCwgcXVlcnldID0gdXNlTGlzdCgndXNlcicpOwogICAgY29uc3QgW3JvbGVMaXN0LCBxdWVyeVJvbGVMaXN0XSA9IHVzZUxpc3QoJ3JvbGUnKTsKICAgIGNvbnN0IFtrZXl3b3JkcywgZmlsdGVyZWRdID0gdXNlU2VhcmNoKGxpc3QsIHsKICAgICAgaW5jbHVkZVByb3BzOiBbJ3VzZXJuYW1lJywgJ2lkJywgJ3JvbGUubmFtZScsICduYW1lJywgJ3Bob25lJ10sCiAgICB9KTsKICAgIGNvbnN0IG1vZGFsID0gcmVmPGFueT4oewogICAgICB2aXNpYmxlOiBmYWxzZSwKICAgICAgZGF0YToge30sCiAgICB9KTsKICAgIGNvbnN0IGZvcm0gPSByZWY8RWxGb3JtfG51bGw+KG51bGwpOwoKICAgIGZ1bmN0aW9uIHZhbGlkYXRvcihydWxlOiBhbnksIHZhbHVlOiBzdHJpbmcsIGNhbGxiYWNrOiBGdW5jdGlvbikgewogICAgICBpZiAoIXZhbHVlICYmIChtb2RhbC52YWx1ZS5kYXRhLnB3ZCAhPT0gJycgKSkgewogICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcign6K+35YaN5qyh6L6T5YWl5a+G56CBJykpOwogICAgICB9IGVsc2UgaWYgKHZhbHVlICE9PSBtb2RhbC52YWx1ZS5kYXRhLnB3ZCkgewogICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcign5Lik5qyh6L6T5YWl5a+G56CB5LiN5LiA6Ie0IScpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYWxsYmFjaygpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBzaG93Rm9ybShyb3c/OiBJVXNlcikgewogICAgICBpZiAocm93KSB7CiAgICAgICAgcm93LnB3ZCA9ICcnOwogICAgICAgIChyb3cgYXMgYW55KS5wd2RDaGVjayA9ICcnOwogICAgICB9CiAgICAgIG1vZGFsLnZhbHVlLmRhdGEgPSByb3cgPyBkZWVwQ2xvbmUocm93KSA6IGluaXRGb3JtKCk7CiAgICAgIG1vZGFsLnZhbHVlLnZpc2libGUgPSB0cnVlOwogICAgICBpZiAoZm9ybS52YWx1ZSkgeyAoZm9ybS52YWx1ZSBhcyBFbEZvcm0pLmNsZWFyVmFsaWRhdGUoKTsgfQogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gdXBkYXRlKCkgewogICAgICBjb25zdCB2YWxpZCA9IGF3YWl0IChmb3JtLnZhbHVlIGFzIEVsRm9ybSkudmFsaWRhdGUoKTsKICAgICAgaWYgKCF2YWxpZCkgeyByZXR1cm4gOyB9CiAgICAgIGNvbnN0IHBheWxvYWQgPSB7CiAgICAgICAgaWQ6IG1vZGFsLnZhbHVlLmRhdGEuaWQsCiAgICAgICAgdXNlcm5hbWU6IG1vZGFsLnZhbHVlLmRhdGEudXNlcm5hbWUsCiAgICAgICAgbmFtZTogbW9kYWwudmFsdWUuZGF0YS5uYW1lLAogICAgICAgIHBob25lOiBtb2RhbC52YWx1ZS5kYXRhLnBob25lLAogICAgICAgIHB3ZDogbW9kYWwudmFsdWUuZGF0YS5wd2QsCiAgICAgICAgcm9sZTogbW9kYWwudmFsdWUuZGF0YS5yb2xlLmlkLAogICAgICB9OwogICAgICBpZiAoIW1vZGFsLnZhbHVlLmRhdGEuaWQpIHsKICAgICAgICBhd2FpdCBwb3N0U2VydmljZSh1cmxNYXAudXNlcl9hZGQudXJsLCBwYXlsb2FkKTsKICAgICAgICBNZXNzYWdlLnN1Y2Nlc3MoJ+a3u+WKoOaIkOWKnycpOwogICAgICB9IGVsc2UgewogICAgICAgIGF3YWl0IHBvc3RTZXJ2aWNlKHVybE1hcC51c2VyX3VwZGF0ZS51cmwsIHBheWxvYWQpOwogICAgICAgIE1lc3NhZ2Uuc3VjY2Vzcygn5L+u5pS55oiQ5YqfJyk7CiAgICAgIH0KICAgICAgbW9kYWwudmFsdWUudmlzaWJsZSA9IGZhbHNlOwogICAgICBhd2FpdCBxdWVyeSgpOwogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gdG9nZ2xlU3RhdHVzKHJvdzogSVVzZXIpIHsKICAgICAgY29uc3Qgb2ZmID0gcm93Lm9mZjsKICAgICAgYXdhaXQgcG9zdFNlcnZpY2UodXJsTWFwLnVzZXJfb2ZmLnVybCwgewogICAgICAgIHVpZDogcm93LmlkLAogICAgICAgIG9mZjogIW9mZiwKICAgICAgfSk7CiAgICAgIE1lc3NhZ2Uuc3VjY2VzcyhgJHtvZmYgPT09IFN0YXR1cy5Ob3JtYWwgPyAn5Ya757uTJyA6ICfmgaLlpI0nfeaIkOWKn2ApOwogICAgICBhd2FpdCBxdWVyeSgpOwogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gcmVtb3ZlKHJvdzogSVVzZXIpIHsKICAgICAgYXdhaXQgcG9zdFNlcnZpY2UodXJsTWFwLnVzZXJfZGVsZXRlLnVybCwgeyBpZDogcm93LmlkLCBvZmY6IDAgfSk7CiAgICAgIGF3YWl0IHF1ZXJ5KCk7CiAgICAgIE1lc3NhZ2Uuc3VjY2Vzcygn5Yig6Zmk5oiQ5YqfJyk7CiAgICB9CiAgICBvbk1vdW50ZWQodXNlTG9hZGluZyhsb2FkaW5nLCBhc3luYyAoKSA9PiB7CiAgICAgIGF3YWl0IFByb21pc2UuYWxsKFsKICAgICAgICBxdWVyeVJvbGVMaXN0KHsKICAgICAgICAgIHJvb3Q6IDAsCiAgICAgICAgfSksCiAgICAgICAgcXVlcnkoKSwKICAgICAgXSk7CiAgICB9KSk7CiAgICByZXR1cm4gewogICAgICBsb2FkaW5nLCBrZXl3b3JkcywgZmlsdGVyZWQsCiAgICAgIHNob3dGb3JtLAogICAgICBzdG9yZVVzZXJJbmZvLCByb2xlTGlzdCwKICAgICAgcmVtb3ZlOiB1c2VDb25maXJtKCfnoa7orqTliKDpmaTvvJ8nLCB1c2VMb2FkaW5nKGxvYWRpbmcsIHJlbW92ZSkpLAogICAgICB0b2dnbGVTdGF0dXM6IHVzZUxvYWRpbmcobG9hZGluZywgdG9nZ2xlU3RhdHVzKSwKICAgICAgdmFsaWRhdG9yLCBtb2RhbCwgZm9ybSwKICAgICAgdXBkYXRlOiB1c2VMb2FkaW5nKGxvYWRpbmcsIHVwZGF0ZSksCiAgICB9OwogIH0sCn0pOwplbnVtIFN0YXR1cyB7CiAgTm9ybWFsID0gMCwKICBGcm96ZW4gPSAxLAp9CmZ1bmN0aW9uIGluaXRGb3JtKCk6IGFueSB7CiAgcmV0dXJuIHsKICAgIHVzZXJuYW1lOiB1bmRlZmluZWQsCiAgICByb2xlOiB1bmRlZmluZWQsCiAgICBuYW1lOiB1bmRlZmluZWQsCiAgICBwaG9uZTogdW5kZWZpbmVkLAogICAgcHdkOiAnJywKICAgIHB3ZENoZWNrOiAnJywKICB9Owp9Cg=="},{"version":3,"sources":["user.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"user.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\n  <div v-loading=\"loading\">\n    <div class=\"flex align-center between little-space\">\n      <el-button type=\"success\" @click=\"showForm()\">添加系统用户</el-button>\n      <el-input class=\"search-bar\" v-model=\"keywords\" placeholder=\"请输入搜索内容\" clearable/>\n    </div>\n    <lkt-table :data=\"filtered\">\n      <el-table-column label=\"账户登录名\" prop=\"username\" sortable min-width=\"120\"/>\n      <el-table-column label=\"角色\" prop=\"role.name\" sortable min-width=\"120\"/>\n      <el-table-column label=\"姓名\" prop=\"name\" sortable min-width=\"140\"/>\n      <el-table-column label=\"手机\" prop=\"phone\" sortable width=\"130\"/>\n      <el-table-column label=\"账号状态\" sortable width=\"100\">\n        <template slot-scope=\"{ row }\">\n          <el-tag v-if=\"row.off === 0\" type=\"success\">正常</el-tag>\n          <el-tag v-if=\"row.off === 1\" type=\"danger\">冻结</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\" align=\"center\" min-width=\"160\">\n        <div class=\"flex center little-space wrap\" slot-scope=\"{ row }\">\n          <el-button type=\"primary\" class=\"align\" size=\"mini\" @click=\"showForm(row)\">修改</el-button>\n          <el-button\n            v-if=\"storeUserInfo.user.id !== row.id\"\n            size=\"mini\" :type=\"row.off === 0 ? 'warning' : 'success'\"\n            @click=\"toggleStatus(row)\"\n          >{{ row.off === 0 ? '冻结' : '恢复' }}</el-button>\n          <el-button type=\"danger\" size=\"mini\" @click=\"remove(row)\">删除</el-button>\n        </div>\n      </el-table-column>\n    </lkt-table>\n    <kit-dialog-simple\n      :modal=\"modal\"\n      :confirm=\"update\"\n      width=\"40%\">\n      <div slot=\"title\">{{modal.data.id? '修改':'添加'}}账户</div>\n      <el-form ref=\"form\" label-position=\"left\" label-width=\"120px\" :model=\"modal.data\">\n        <el-form-item label=\"账户登录名：\" prop=\"username\" :rules=\"{ required: true, message: '请填写账户登录名' }\">\n          <el-input clearable v-model=\"modal.data.username\" placeholder=\"请输入账户登录名\" />\n        </el-form-item>\n        <el-form-item label=\"角色：\" prop=\"role\" :rules=\"{ required: true, message: '请选择角色' }\">\n          <el-select value-key=\"id\" v-model=\"modal.data.role\">\n            <el-option v-for=\"role in roleList\" :key=\"role.id\" :label=\"role.name\" :value=\"role\" />\n          </el-select>\n        </el-form-item>\n        <el-form-item :label=\"!modal.data.id ? '密码：' : '修改密码：'\" prop=\"pwd\" :rules=\"[{ required: !modal.data.id, message: '请填写密码' }, { type: 'string', min: 6, message: '密码长度不能小于6位', trigger: 'blur'}]\">\n          <el-input clearable v-model=\"modal.data.pwd\" type=\"password\" />\n        </el-form-item>\n        <el-form-item label=\"确认密码：\" prop=\"pwdCheck\" :rules=\"{ required: !modal.data.id, validator: validator }\">\n          <el-input clearable v-model=\"modal.data.pwdCheck\" type=\"password\" />\n        </el-form-item>\n        <el-form-item label=\"姓名：\" prop=\"name\" :rules=\"{ required: true, message: '请填写姓名' }\">\n          <el-input clearable v-model=\"modal.data.name\" placeholder=\"请输入姓名\"/>\n        </el-form-item>\n        <el-form-item label=\"手机：\" prop=\"phone\" >\n          <el-input clearable v-model=\"modal.data.phone\"/>\n        </el-form-item>\n      </el-form>\n    </kit-dialog-simple>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { ref, onMounted, createComponent } from '@vue/composition-api';\nimport { Message } from 'element-ui';\nimport { useSearch, useLoading, useConfirm } from 'web-toolkit/src/service';\nimport { deepClone } from 'web-toolkit/src/utils';\nimport {postService, storeUserInfo} from 'web-toolkit/src/case-main';\nimport {useList} from '@/utils/use-list';\nimport {IUser} from '@/types/beans';\nimport {urlMap} from '@/config';\nimport {ElForm} from 'element-ui/types/form';\nexport default createComponent({\n  name: 'User',\n  setup() {\n    const loading = ref(false);\n    const [list, query] = useList('user');\n    const [roleList, queryRoleList] = useList('role');\n    const [keywords, filtered] = useSearch(list, {\n      includeProps: ['username', 'id', 'role.name', 'name', 'phone'],\n    });\n    const modal = ref<any>({\n      visible: false,\n      data: {},\n    });\n    const form = ref<ElForm|null>(null);\n\n    function validator(rule: any, value: string, callback: Function) {\n      if (!value && (modal.value.data.pwd !== '' )) {\n        callback(new Error('请再次输入密码'));\n      } else if (value !== modal.value.data.pwd) {\n        callback(new Error('两次输入密码不一致!'));\n      } else {\n        callback();\n      }\n    }\n    function showForm(row?: IUser) {\n      if (row) {\n        row.pwd = '';\n        (row as any).pwdCheck = '';\n      }\n      modal.value.data = row ? deepClone(row) : initForm();\n      modal.value.visible = true;\n      if (form.value) { (form.value as ElForm).clearValidate(); }\n    }\n    async function update() {\n      const valid = await (form.value as ElForm).validate();\n      if (!valid) { return ; }\n      const payload = {\n        id: modal.value.data.id,\n        username: modal.value.data.username,\n        name: modal.value.data.name,\n        phone: modal.value.data.phone,\n        pwd: modal.value.data.pwd,\n        role: modal.value.data.role.id,\n      };\n      if (!modal.value.data.id) {\n        await postService(urlMap.user_add.url, payload);\n        Message.success('添加成功');\n      } else {\n        await postService(urlMap.user_update.url, payload);\n        Message.success('修改成功');\n      }\n      modal.value.visible = false;\n      await query();\n    }\n    async function toggleStatus(row: IUser) {\n      const off = row.off;\n      await postService(urlMap.user_off.url, {\n        uid: row.id,\n        off: !off,\n      });\n      Message.success(`${off === Status.Normal ? '冻结' : '恢复'}成功`);\n      await query();\n    }\n    async function remove(row: IUser) {\n      await postService(urlMap.user_delete.url, { id: row.id, off: 0 });\n      await query();\n      Message.success('删除成功');\n    }\n    onMounted(useLoading(loading, async () => {\n      await Promise.all([\n        queryRoleList({\n          root: 0,\n        }),\n        query(),\n      ]);\n    }));\n    return {\n      loading, keywords, filtered,\n      showForm,\n      storeUserInfo, roleList,\n      remove: useConfirm('确认删除？', useLoading(loading, remove)),\n      toggleStatus: useLoading(loading, toggleStatus),\n      validator, modal, form,\n      update: useLoading(loading, update),\n    };\n  },\n});\nenum Status {\n  Normal = 0,\n  Frozen = 1,\n}\nfunction initForm(): any {\n  return {\n    username: undefined,\n    role: undefined,\n    name: undefined,\n    phone: undefined,\n    pwd: '',\n    pwdCheck: '',\n  };\n}\n</script>\n\n"]}]}