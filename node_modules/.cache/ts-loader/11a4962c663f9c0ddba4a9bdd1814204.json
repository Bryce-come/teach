{"remainingRequest":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/babel-loader/lib/index.js!/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/ts-loader/index.js??ref--13-2!/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/web-toolkit/src/case-main/store/index.ts","dependencies":[{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/web-toolkit/src/case-main/store/index.ts","mtime":1579004471000},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/cache-loader/dist/cjs.js","mtime":1574737719973},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/babel-loader/lib/index.js","mtime":1574737707076},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/ts-loader/index.js","mtime":1574737715182}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCB7IHJlYWN0aXZlIH0gZnJvbSAnQHZ1ZS9jb21wb3NpdGlvbi1hcGknOwpleHBvcnQgdmFyIHN0b3JlQ3VycmVudFJvdXRlID0gcmVhY3RpdmUoewogIG5hbWU6ICdpbmRleCcsCiAgcGF0aDogJy8nLAogIG1ldGE6IHVuZGVmaW5lZAp9KTsKZXhwb3J0IHZhciBzdG9yZVVzZXJJbmZvID0gcmVhY3RpdmUoewogIHVzZXI6IHVuZGVmaW5lZCwKICB0b2tlbjogdW5kZWZpbmVkLAogIHJlZGlyZWN0OiB1bmRlZmluZWQKfSk7CmV4cG9ydCB2YXIgc3RvcmVQYWdlTWVudSA9IHJlYWN0aXZlKFtdKTsKZXhwb3J0IGZ1bmN0aW9uIGluaXRTdG9yZVVzZXJJbmZvKCkgewogIHZhciBkYXRhSnNvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHByb2Nlc3MuZW52LlZVRV9BUFBfQVBQX05BTUUgKyAnLXVzZXInKTsKCiAgaWYgKCFkYXRhSnNvbikgewogICAgc3RvcmVVc2VySW5mby51c2VyID0gdW5kZWZpbmVkOwogICAgc3RvcmVVc2VySW5mby50b2tlbiA9IHVuZGVmaW5lZDsKICAgIHN0b3JlVXNlckluZm8uc2V0dGluZyA9IHVuZGVmaW5lZDsKICB9IGVsc2UgewogICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKGRhdGFKc29uKTsgLy8g6L+H5pyf562W55WlCgogICAgaWYgKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gZGF0YS5leHBpcmUgPiAwKSB7CiAgICAgIHJtU3RvcmVVc2VySW5mbygpOwogICAgfSBlbHNlIHsKICAgICAgc3RvcmVVc2VySW5mby51c2VyID0gZGF0YS51c2VyOwogICAgICBzdG9yZVVzZXJJbmZvLnRva2VuID0gZGF0YS50b2tlbjsKICAgICAgc3RvcmVVc2VySW5mby5zZXR0aW5nID0gZGF0YS5zZXR0aW5nOwogICAgfQogIH0KfQpleHBvcnQgZnVuY3Rpb24gdXBkYXRlU3RvcmVVc2VySW5mbyhkYXRhKSB7CiAgc3RvcmVVc2VySW5mby51c2VyID0gZGF0YS51c2VyOwogIHN0b3JlVXNlckluZm8udG9rZW4gPSBkYXRhLnRva2VuOwogIHN0b3JlVXNlckluZm8uc2V0dGluZyA9IGRhdGEuc2V0dGluZzsKICBzdG9yZVVzZXJJbmZvLmV4cGlyZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgMTAwMCAqIDYwICogNjAgKiAyMDsgLy8g6L+H5pyf5pe26Ze0IDIwaAoKICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShwcm9jZXNzLmVudi5WVUVfQVBQX0FQUF9OQU1FICsgJy11c2VyJywgSlNPTi5zdHJpbmdpZnkoc3RvcmVVc2VySW5mbykpOwp9CmV4cG9ydCBmdW5jdGlvbiBybVN0b3JlVXNlckluZm8oKSB7CiAgZm9yICh2YXIga2V5IGluIHN0b3JlVXNlckluZm8pIHsKICAgIC8vIEB0cy1pZ25vcmUKICAgIGRlbGV0ZSBzdG9yZVVzZXJJbmZvW2tleV07CiAgfQoKICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShwcm9jZXNzLmVudi5WVUVfQVBQX0FQUF9OQU1FICsgJy11c2VyJyk7Cn0KZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVN0b3JlQ3VycmVudFJvdXRlKHJvdXRlKSB7CiAgc3RvcmVDdXJyZW50Um91dGUubWV0YSA9IHJvdXRlLm1ldGE7CiAgc3RvcmVDdXJyZW50Um91dGUubmFtZSA9IHJvdXRlLm5hbWU7CiAgc3RvcmVDdXJyZW50Um91dGUucGF0aCA9IHJvdXRlLnBhdGg7CiAgc3RvcmVDdXJyZW50Um91dGUucXVlcnkgPSByb3V0ZS5xdWVyeTsKICBzdG9yZUN1cnJlbnRSb3V0ZS5wYXJhbXMgPSByb3V0ZS5wYXJhbXM7Cn0="},{"version":3,"sources":["/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/web-toolkit/src/case-main/store/index.ts"],"names":[],"mappings":";AAAA,SAAS,QAAT,QAAyB,sBAAzB;AAcA,OAAO,IAAM,iBAAiB,GAAG,QAAQ,CAAc;AACrD,EAAA,IAAI,EAAE,OAD+C;AAErD,EAAA,IAAI,EAAE,GAF+C;AAGrD,EAAA,IAAI,EAAE;AAH+C,CAAd,CAAlC;AAeP,OAAO,IAAM,aAAa,GAAG,QAAQ,CAAiB;AACpD,EAAA,IAAI,EAAE,SAD8C;AAEpD,EAAA,KAAK,EAAE,SAF6C;AAGpD,EAAA,QAAQ,EAAE;AAH0C,CAAjB,CAA9B;AAeP,OAAO,IAAM,aAAa,GAAG,QAAQ,CAAc,EAAd,CAA9B;AAEP,OAAM,SAAU,iBAAV,GAA2B;AAC/B,MAAM,QAAQ,GAAG,YAAY,CAAC,OAAb,CAAqB,OAAO,CAAC,GAAR,CAAY,gBAAZ,GAA+B,OAApD,CAAjB;;AACA,MAAI,CAAC,QAAL,EAAe;AACb,IAAA,aAAa,CAAC,IAAd,GAAqB,SAArB;AACA,IAAA,aAAa,CAAC,KAAd,GAAsB,SAAtB;AACA,IAAA,aAAa,CAAC,OAAd,GAAwB,SAAxB;AACD,GAJD,MAIO;AACL,QAAM,IAAI,GAAG,IAAI,CAAC,KAAL,CAAW,QAAX,CAAb,CADK,CAEL;;AACA,QAAI,IAAI,IAAJ,GAAW,OAAX,KAAuB,IAAI,CAAC,MAA5B,GAAqC,CAAzC,EAA4C;AAC1C,MAAA,eAAe;AAChB,KAFD,MAEO;AACL,MAAA,aAAa,CAAC,IAAd,GAAqB,IAAI,CAAC,IAA1B;AACA,MAAA,aAAa,CAAC,KAAd,GAAsB,IAAI,CAAC,KAA3B;AACA,MAAA,aAAa,CAAC,OAAd,GAAwB,IAAI,CAAC,OAA7B;AACD;AACF;AACF;AACD,OAAM,SAAU,mBAAV,CAA8B,IAA9B,EAAkD;AACtD,EAAA,aAAa,CAAC,IAAd,GAAqB,IAAI,CAAC,IAA1B;AACA,EAAA,aAAa,CAAC,KAAd,GAAsB,IAAI,CAAC,KAA3B;AACA,EAAA,aAAa,CAAC,OAAd,GAAwB,IAAI,CAAC,OAA7B;AACA,EAAA,aAAa,CAAC,MAAd,GAAuB,IAAI,IAAJ,GAAW,OAAX,KAAuB,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAA/D,CAJsD,CAIa;;AACnE,EAAA,YAAY,CAAC,OAAb,CAAqB,OAAO,CAAC,GAAR,CAAY,gBAAZ,GAA+B,OAApD,EAA6D,IAAI,CAAC,SAAL,CAAe,aAAf,CAA7D;AACD;AACD,OAAM,SAAU,eAAV,GAAyB;AAC7B,OAAK,IAAM,GAAX,IAAkB,aAAlB,EAAiC;AAC/B;AACA,WAAO,aAAa,CAAC,GAAD,CAApB;AACD;;AACD,EAAA,YAAY,CAAC,UAAb,CAAwB,OAAO,CAAC,GAAR,CAAY,gBAAZ,GAA+B,OAAvD;AACD;AAED,OAAM,SAAU,uBAAV,CAAkC,KAAlC,EAA4C;AAChD,EAAA,iBAAiB,CAAC,IAAlB,GAAyB,KAAK,CAAC,IAA/B;AACA,EAAA,iBAAiB,CAAC,IAAlB,GAAyB,KAAK,CAAC,IAA/B;AACA,EAAA,iBAAiB,CAAC,IAAlB,GAAyB,KAAK,CAAC,IAA/B;AACA,EAAA,iBAAiB,CAAC,KAAlB,GAA0B,KAAK,CAAC,KAAhC;AACA,EAAA,iBAAiB,CAAC,MAAlB,GAA2B,KAAK,CAAC,MAAjC;AACD","sourcesContent":["import { reactive } from '@vue/composition-api';\nimport { IUser } from '..';\nimport { Route } from 'vue-router';\n\n// reactive的数据必须初始，否则无法响应？\n\n// 实时保存当前路由对象\ninterface IStoreRoute {\n  meta?: object;\n  name: string;\n  path: string;\n  query?: object;\n  params?: object;\n}\nexport const storeCurrentRoute = reactive<IStoreRoute>({\n  name: 'index',\n  path: '/',\n  meta: undefined,\n});\n\ninterface IUserLoginInfo {\n  user?: IUser;\n  token?: string;\n  // 用于跳转地址\n  redirect?: Route;\n  // 用于storage中的过期时间\n  expire?: number;\n  setting?: object;\n}\nexport const storeUserInfo = reactive<IUserLoginInfo>({\n  user: undefined,\n  token: undefined,\n  redirect: undefined,\n});\n\n// 菜单信息等\nexport interface IMenuItem {\n  children?: IMenuItem[];\n  icon?: string;\n  privileges?: string[];\n  title?: string;\n  name?: string;\n  cTitle?: string;\n}\nexport const storePageMenu = reactive<IMenuItem[]>([]);\n\nexport function initStoreUserInfo() {\n  const dataJson = localStorage.getItem(process.env.VUE_APP_APP_NAME + '-user');\n  if (!dataJson) {\n    storeUserInfo.user = undefined;\n    storeUserInfo.token = undefined;\n    storeUserInfo.setting = undefined;\n  } else {\n    const data = JSON.parse(dataJson);\n    // 过期策略\n    if (new Date().getTime() - data.expire > 0) {\n      rmStoreUserInfo();\n    } else {\n      storeUserInfo.user = data.user;\n      storeUserInfo.token = data.token;\n      storeUserInfo.setting = data.setting;\n    }\n  }\n}\nexport function updateStoreUserInfo(data: IUserLoginInfo) {\n  storeUserInfo.user = data.user;\n  storeUserInfo.token = data.token;\n  storeUserInfo.setting = data.setting;\n  storeUserInfo.expire = new Date().getTime() + 1000 * 60 * 60 * 20; // 过期时间 20h\n  localStorage.setItem(process.env.VUE_APP_APP_NAME + '-user', JSON.stringify(storeUserInfo));\n}\nexport function rmStoreUserInfo() {\n  for (const key in storeUserInfo) {\n    // @ts-ignore\n    delete storeUserInfo[key];\n  }\n  localStorage.removeItem(process.env.VUE_APP_APP_NAME + '-user');\n}\n\nexport function updateStoreCurrentRoute(route: any) {\n  storeCurrentRoute.meta = route.meta;\n  storeCurrentRoute.name = route.name;\n  storeCurrentRoute.path = route.path;\n  storeCurrentRoute.query = route.query;\n  storeCurrentRoute.params = route.params;\n}\n"],"sourceRoot":""}]}