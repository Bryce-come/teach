{"remainingRequest":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/babel-loader/lib/index.js!/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/ts-loader/index.js??ref--13-2!/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/web-toolkit/src/case-main/request/interceptors.ts","dependencies":[{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/web-toolkit/src/case-main/request/interceptors.ts","mtime":1579004471000},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/cache-loader/dist/cjs.js","mtime":1574737719973},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/babel-loader/lib/index.js","mtime":1574737707076},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/ts-loader/index.js","mtime":1574737715182}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0IFFzIGZyb20gJ3FzJzsKaW1wb3J0IHsgQ2FuY2VsVG9rZW5Tb3VyY2VzIH0gZnJvbSAnLi9pbmRleCc7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCB7IHN0b3JlVXNlckluZm8sIHJtU3RvcmVVc2VySW5mbyB9IGZyb20gJy4uL3N0b3JlJzsKZXhwb3J0IGZ1bmN0aW9uIGF4aW9zSW50ZXJjZXB0KHJvdXRlcikgewogIGF4aW9zLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UoZnVuY3Rpb24gKHJlcykgewogICAgLy8g55So5LqOYXhpb3Plj5bmtojor7fmsYIKICAgIGlmIChyZXMuY29uZmlnKSB7CiAgICAgIHZhciB0b2tlbiA9IHJlcy5jb25maWcuY2FuY2VsVG9rZW47CgogICAgICBpZiAodG9rZW4pIHsKICAgICAgICB2YXIgc291cmNlID0gQ2FuY2VsVG9rZW5Tb3VyY2VzLmZpbmQoZnVuY3Rpb24gKHNvdXJjZSkgewogICAgICAgICAgcmV0dXJuIHNvdXJjZS50b2tlbiA9PT0gdG9rZW47CiAgICAgICAgfSk7CgogICAgICAgIGlmIChzb3VyY2UpIHsKICAgICAgICAgIENhbmNlbFRva2VuU291cmNlcy5zcGxpY2UoQ2FuY2VsVG9rZW5Tb3VyY2VzLmluZGV4T2Yoc291cmNlKSwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zb2xlLmxvZyhyZXMpOwogICAgfSAvLyDov5Tlm57ml7bnm7TmjqXov5Tlm57nmoRkYXRhCgoKICAgIHJldHVybiByZXMgPyByZXMuZGF0YSA6IG51bGw7CiAgfSwgZnVuY3Rpb24gKGUpIHsKICAgIC8vIOWPquWkhOeQhnJlc3VsdD09Mu+8jOWFtuS7luS6pOe7mWNhdGNoCiAgICBpZiAoZS5yZXNwb25zZSAmJiBlLnJlc3BvbnNlLmRhdGEgJiYgZS5yZXNwb25zZS5kYXRhLnJlc3VsdCA9PT0gMikgewogICAgICBybVN0b3JlVXNlckluZm8oKTsKICAgICAgcm91dGVyLnB1c2goewogICAgICAgIG5hbWU6ICdsb2dpbicKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBlOwogICAgfSAvLyBjb25zb2xlLmxvZyhyZXMuZGF0YSkKICAgIC8vIGlmKCFyZXMgfHwgIXJlcy5kYXRhKSByZXR1cm47CiAgICAvLyAvLyDmjqXlj6PplJnor6/lkI7nmoRqc29u5pWw5o2u5aSE55CGCiAgICAvLyBpZiAocmVzLmRhdGEucmVzdWx0ID09PSAwKSB7CiAgICAvLyAgIE1lc3NhZ2UuZXJyb3IoJ+ivt+axgumUmeivr++8micgKyByZXMuZGF0YS5tZXNzYWdlKTsKICAgIC8vICAgLy8gdGhyb3cgbmV3IEVycm9yKCfor7fmsYLplJnor6/vvJonICsgcmVzLmRhdGEubWVzc2FnZSk7CiAgICAvLyB9IGVsc2UgaWYgKHJlcy5kYXRhLnJlc3VsdCA9PT0gMikgewogICAgLy8KICAgIC8vICAgLy8gdGhyb3cgbmV3IEVycm9yKCfnmbvlvZXlpLHmlYgnKTsKICAgIC8vIH0KCiAgfSk7CiAgYXhpb3MuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKGZ1bmN0aW9uIChjb25maWcpIHsKICAgIC8qKgogICAgICog55Sf5oiQ5LiA5Liq6K+35rGC55qEdG9rZW7lubbmlL7lhaXor7fmsYLliJfooajkuK0sIOWcqOmhtemdoui3s+i9rOWJjeWPr+S7peWwhuWIl+ihqOS4reeahOaJgOacieivt+axguS4reatoumBv+WFjeW/q+mAn+i3s+i9rOmhtemdouW8lei1t+eahOWkp+mHj+ivt+axgueahGJ1ZwogICAgICovCiAgICB2YXIgc291cmNlID0gYXhpb3MuQ2FuY2VsVG9rZW4uc291cmNlKCk7CiAgICBjb25maWcuY2FuY2VsVG9rZW4gPSBzb3VyY2UudG9rZW47CiAgICBDYW5jZWxUb2tlblNvdXJjZXMucHVzaChzb3VyY2UpOwogICAgdmFyIGRhdGEgPSBRcy5wYXJzZShjb25maWcuZGF0YSk7CiAgICBkYXRhLnRva2VuID0gc3RvcmVVc2VySW5mby50b2tlbjsKICAgIGNvbmZpZy5kYXRhID0gUXMuc3RyaW5naWZ5KGRhdGEpOwogICAgcmV0dXJuIGNvbmZpZzsKICB9KTsKfQ=="},{"version":3,"sources":["/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/web-toolkit/src/case-main/request/interceptors.ts"],"names":[],"mappings":";;;AAAA,OAAO,EAAP,MAAe,IAAf;AACA,SAAS,kBAAT,QAAmC,SAAnC;AACA,OAAO,KAAP,MAAkB,OAAlB;AAEA,SAAS,aAAT,EAAwB,eAAxB,QAA+C,UAA/C;AAEA,OAAM,SAAU,cAAV,CAAyB,MAAzB,EAA0C;AAC9C,EAAA,KAAK,CAAC,YAAN,CAAmB,QAAnB,CAA4B,GAA5B,CAAgC,UAAC,GAAD,EAAQ;AACpC;AACA,QAAI,GAAG,CAAC,MAAR,EAAgB;AACd,UAAM,KAAK,GAAG,GAAG,CAAC,MAAJ,CAAW,WAAzB;;AACA,UAAI,KAAJ,EAAW;AACT,YAAM,MAAM,GAAG,kBAAkB,CAAC,IAAnB,CAAwB,UAAC,MAAD;AAAA,iBAAY,MAAM,CAAC,KAAP,KAAiB,KAA7B;AAAA,SAAxB,CAAf;;AACA,YAAI,MAAJ,EAAY;AACV,UAAA,kBAAkB,CAAC,MAAnB,CAA0B,kBAAkB,CAAC,OAAnB,CAA2B,MAA3B,CAA1B,EAA8D,CAA9D;AACD;AACF;AACF,KARD,MAQO;AACL,MAAA,OAAO,CAAC,GAAR,CAAY,GAAZ;AACD,KAZmC,CAapC;;;AACA,WAAO,GAAG,GAAG,GAAG,CAAC,IAAP,GAAc,IAAxB;AACD,GAfH,EAeK,UAAC,CAAD,EAAM;AACP;AACA,QAAI,CAAC,CAAC,QAAF,IAAc,CAAC,CAAC,QAAF,CAAW,IAAzB,IAAiC,CAAC,CAAC,QAAF,CAAW,IAAX,CAAgB,MAAhB,KAA2B,CAAhE,EAAmE;AACjE,MAAA,eAAe;AACf,MAAA,MAAM,CAAC,IAAP,CAAY;AAAE,QAAA,IAAI,EAAE;AAAR,OAAZ;AACD,KAHD,MAGO;AACL,YAAM,CAAN;AACD,KAPM,CAQP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACD,GAjCH;AAmCA,EAAA,KAAK,CAAC,YAAN,CAAmB,OAAnB,CAA2B,GAA3B,CAA+B,UAAC,MAAD,EAAW;AACxC;;;AAGA,QAAM,MAAM,GAAG,KAAK,CAAC,WAAN,CAAkB,MAAlB,EAAf;AACA,IAAA,MAAM,CAAC,WAAP,GAAqB,MAAM,CAAC,KAA5B;AACA,IAAA,kBAAkB,CAAC,IAAnB,CAAwB,MAAxB;AACA,QAAM,IAAI,GAAG,EAAE,CAAC,KAAH,CAAS,MAAM,CAAC,IAAhB,CAAb;AACA,IAAA,IAAI,CAAC,KAAL,GAAa,aAAa,CAAC,KAA3B;AACA,IAAA,MAAM,CAAC,IAAP,GAAc,EAAE,CAAC,SAAH,CAAa,IAAb,CAAd;AACA,WAAO,MAAP;AACD,GAXD;AAYD","sourcesContent":["import Qs from 'qs';\nimport { CancelTokenSources } from './index';\nimport axios from 'axios';\nimport VueRouter from 'vue-router';\nimport { storeUserInfo, rmStoreUserInfo } from '../store';\n\nexport function axiosIntercept(router: VueRouter) {\n  axios.interceptors.response.use((res) => {\n      // 用于axios取消请求\n      if (res.config) {\n        const token = res.config.cancelToken;\n        if (token) {\n          const source = CancelTokenSources.find((source) => source.token === token);\n          if (source) {\n            CancelTokenSources.splice(CancelTokenSources.indexOf(source), 1);\n          }\n        }\n      } else {\n        console.log(res);\n      }\n      // 返回时直接返回的data\n      return res ? res.data : null;\n    }, (e) => {\n      // 只处理result==2，其他交给catch\n      if (e.response && e.response.data && e.response.data.result === 2) {\n        rmStoreUserInfo();\n        router.push({ name: 'login' });\n      } else {\n        throw e;\n      }\n      // console.log(res.data)\n      // if(!res || !res.data) return;\n      // // 接口错误后的json数据处理\n      // if (res.data.result === 0) {\n      //   Message.error('请求错误：' + res.data.message);\n      //   // throw new Error('请求错误：' + res.data.message);\n      // } else if (res.data.result === 2) {\n      //\n      //   // throw new Error('登录失效');\n      // }\n    },\n  );\n  axios.interceptors.request.use((config) => {\n    /**\n     * 生成一个请求的token并放入请求列表中, 在页面跳转前可以将列表中的所有请求中止避免快速跳转页面引起的大量请求的bug\n     */\n    const source = axios.CancelToken.source();\n    config.cancelToken = source.token;\n    CancelTokenSources.push(source);\n    const data = Qs.parse(config.data);\n    data.token = storeUserInfo.token;\n    config.data = Qs.stringify(data);\n    return config;\n  });\n}\n"],"sourceRoot":""}]}