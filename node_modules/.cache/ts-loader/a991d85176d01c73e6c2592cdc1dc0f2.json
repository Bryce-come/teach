{"remainingRequest":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/babel-loader/lib/index.js!/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/ts-loader/index.js??ref--13-2!/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/web-toolkit/src/service/use-cache.ts","dependencies":[{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/web-toolkit/src/service/use-cache.ts","mtime":1579004471000},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/cache-loader/dist/cjs.js","mtime":1574737719973},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/babel-loader/lib/index.js","mtime":1574737707076},{"path":"/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/ts-loader/index.js","mtime":1574737715182}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgX3R5cGVvZiBmcm9tICIvVXNlcnMveWNqL1dlYnN0b3JtUHJvamVjdHMvbHR0UHJvamVjdHMvdGVhY2gtcGxhdGZvcm0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90eXBlb2YiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9Vc2Vycy95Y2ovV2Vic3Rvcm1Qcm9qZWN0cy9sdHRQcm9qZWN0cy90ZWFjaC1wbGF0Zm9ybS13ZWIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMveWNqL1dlYnN0b3JtUHJvamVjdHMvbHR0UHJvamVjdHMvdGVhY2gtcGxhdGZvcm0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCB7IGlzVW5kZWZpbmVkIH0gZnJvbSAnLi4vdXRpbHMnOwppbXBvcnQgeyByZWYgfSBmcm9tICdAdnVlL2NvbXBvc2l0aW9uLWFwaSc7CnZhciBsZWdhbFR5cGUgPSBbJ3N0cmluZycsICdudW1iZXInLCAnYm9vbGVhbicsICdvYmplY3QnXTsKdmFyIFBSRUZJWCA9ICd1c2UtY2FjaGUtJzsKCnZhciBNZW1vcnlTdG9yYWdlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gTWVtb3J5U3RvcmFnZSgpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNZW1vcnlTdG9yYWdlKTsKCiAgICB0aGlzLnN0b3JlID0gbmV3IE1hcCgpOwogIH0KCiAgX2NyZWF0ZUNsYXNzKE1lbW9yeVN0b3JhZ2UsIFt7CiAgICBrZXk6ICJnZXRJdGVtIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJdGVtKGtleSkgewogICAgICByZXR1cm4gdGhpcy5zdG9yZS5nZXQoa2V5KSB8fCBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogInNldEl0ZW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldEl0ZW0oa2V5LCB2YWx1ZSkgewogICAgICB0aGlzLnN0b3JlLnNldChrZXksIHZhbHVlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjbGVhciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXIoKSB7CiAgICAgIHRoaXMuc3RvcmUuY2xlYXIoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJrZXkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGtleShpbmRleCkgewogICAgICB2YXIgaXRlciA9IHRoaXMuc3RvcmUua2V5cygpOwogICAgICB2YXIgaSA9IDA7CiAgICAgIHZhciByZXN1bHQ7CiAgICAgIHJlc3VsdCA9IGl0ZXIubmV4dCgpOwoKICAgICAgd2hpbGUgKCFyZXN1bHQuZG9uZSkgewogICAgICAgIGlmIChpID09PSBpbmRleCkgewogICAgICAgICAgcmV0dXJuIHJlc3VsdC52YWx1ZTsKICAgICAgICB9CgogICAgICAgIGkrKzsKICAgICAgICByZXN1bHQgPSBpdGVyLm5leHQoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVtb3ZlSXRlbSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlSXRlbShrZXkpIHsKICAgICAgdGhpcy5zdG9yZS5kZWxldGUoa2V5KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJsZW5ndGgiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLnN0b3JlLnNpemU7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gTWVtb3J5U3RvcmFnZTsKfSgpOwoKdmFyIG1lbW9yeVN0b3JhZ2UgPSBuZXcgTWVtb3J5U3RvcmFnZSgpOwovKioKICog57yT5a2Y5oyH5a6aaWTnmoTmlbDmja4sIOWtmOWFpXN0b3JhZ2UKICogQHBhcmFtIGlkIOaVsOaNrueahOWcqHN0b3JhZ2XkuK3lgqjlrZjml7bnmoRrZXkKICogQHBhcmFtIGluaXRWYWx1ZQogKiBAcGFyYW0gb3B0cwogKi8KCmV4cG9ydCBmdW5jdGlvbiB1c2VDYWNoZShpZCwgaW5pdFZhbHVlKSB7CiAgdmFyIG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogIHZhciBzdG9yYWdlID0gb3B0cy5zdG9yYWdlIHx8ICdzZXNzaW9uJzsKICB2YXIgc3RvcmU7CgogIHN3aXRjaCAoc3RvcmFnZSkgewogICAgY2FzZSAnbG9jYWwnOgogICAgICBzdG9yZSA9IGxvY2FsU3RvcmFnZTsKICAgICAgYnJlYWs7CgogICAgY2FzZSAnc2Vzc2lvbic6CiAgICAgIHN0b3JlID0gc2Vzc2lvblN0b3JhZ2U7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgJ21lbW9yeSc6CiAgICAgIHN0b3JlID0gbWVtb3J5U3RvcmFnZTsKICAgICAgYnJlYWs7CgogICAgZGVmYXVsdDoKICAgICAgc3RvcmUgPSBzZXNzaW9uU3RvcmFnZTsKICAgICAgYnJlYWs7CiAgfQoKICB2YXIgZXhwaXJlID0gaXNVbmRlZmluZWQob3B0cy5leHBpcmUpID8gMCA6IG9wdHMuZXhwaXJlOwoKICB2YXIgdHlwZSA9IF90eXBlb2YoaW5pdFZhbHVlKTsKCiAgaWYgKCFsZWdhbFR5cGUuaW5jbHVkZXModHlwZSkpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoInVzZUNhY2hlOiBJbGxlZ2FsIHR5cGUgPCIuY29uY2F0KHR5cGUsICI+IG9mICIpLmNvbmNhdChpZCwgIi4iKSk7CiAgfQoKICB2YXIgY2FjaGUgPSBzdG9yZS5nZXRJdGVtKFBSRUZJWCArIGlkKTsKICB2YXIgbGFzdE1vZGlmaWVkID0gc3RvcmUuZ2V0SXRlbShQUkVGSVggKyAnbGFzdC1tb2RpZmllZC0nICsgaWQpOwogIHZhciBkYXRhOwoKICBpZiAoY2FjaGUgIT09IG51bGwgJiYgKCFleHBpcmUgfHwgbGFzdE1vZGlmaWVkICYmIERhdGUubm93KCkgLSBuZXcgRGF0ZShsYXN0TW9kaWZpZWQpLmdldFRpbWUoKSA8IGV4cGlyZSkpIHsKICAgIGlmICh0eXBlID09PSAnb2JqZWN0JykgewogICAgICB0cnkgewogICAgICAgIGRhdGEgPSByZWYoSlNPTi5wYXJzZShjYWNoZSkpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihuZXcgU3ludGF4RXJyb3IoIkluIHVzZUNhY2hlOiBjYWNoZSA8Ii5jb25jYXQoaWQsICI+IGlzIDwiKS5jb25jYXQodHlwZSwgIj4sIGJ1dCBKU09OLnBhcnNlIGNhbm5vdCBwYXJzZSBpdCBjb3JyZWN0bHkuIikpKTsKICAgICAgICB0aHJvdyBlOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBkYXRhID0gcmVmKHBhcnNlVmFsdWVUeXBlKGNhY2hlLCB0eXBlKSk7CiAgICB9CiAgfSBlbHNlIHsKICAgIGRhdGEgPSByZWYoaW5pdFZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZSh2YWwpIHsKICAgIHZhciB2YWx1ZTsKCiAgICBpZiAodHlwZSA9PT0gJ29iamVjdCcpIHsKICAgICAgdmFsdWUgPSB2YWwgPyBKU09OLnN0cmluZ2lmeSh2YWwpIDogJyc7CiAgICB9IGVsc2UgewogICAgICB2YWx1ZSA9IFN0cmluZyh2YWwpOwogICAgfQoKICAgIHN0b3JlLnNldEl0ZW0oUFJFRklYICsgaWQsIHZhbHVlKTsKCiAgICBpZiAoZXhwaXJlKSB7CiAgICAgIHN0b3JlLnNldEl0ZW0oUFJFRklYICsgJ2xhc3QtbW9kaWZpZWQtJyArIGlkLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpOwogICAgfQoKICAgIGRhdGEudmFsdWUgPSB2YWw7CiAgICByZXR1cm4gdmFsOwogIH0KCiAgcmV0dXJuIFtkYXRhLCB1cGRhdGVdOwp9CgpmdW5jdGlvbiBwYXJzZVZhbHVlVHlwZShzdHIsIHR5cGUpIHsKICBzd2l0Y2ggKHR5cGUpIHsKICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgIHJldHVybiBzdHI7CgogICAgY2FzZSAnYm9vbGVhbic6CiAgICAgIHJldHVybiBzdHIgPT09ICd0cnVlJyB8fCBmYWxzZTsKCiAgICBjYXNlICdudW1iZXInOgogICAgICByZXR1cm4gTnVtYmVyKHN0cik7CgogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIHN0cjsKICB9Cn0="},{"version":3,"sources":["/Users/ycj/WebstormProjects/lttProjects/teach-platform-web/node_modules/web-toolkit/src/service/use-cache.ts"],"names":[],"mappings":"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","sourcesContent":["import { isUndefined } from '../utils';\nimport { ref, Ref } from '@vue/composition-api';\n\nconst legalType = ['string', 'number', 'boolean', 'object'];\nconst PREFIX = 'use-cache-';\nclass MemoryStorage implements Storage {\n  private store = new Map<string, string>();\n  get length() {\n    return this.store.size;\n  }\n  getItem(key: string) {\n    return this.store.get(key) || null;\n  }\n  setItem(key: string, value: string) {\n    this.store.set(key, value);\n  }\n  clear() {\n    this.store.clear();\n  }\n  key(index: number) {\n    const iter = this.store.keys();\n    let i = 0;\n    let result: IteratorResult<string>;\n    result = iter.next();\n    while (!result.done) {\n      if (i === index) {\n        return result.value;\n      }\n      i++;\n      result = iter.next();\n    }\n    return null;\n  }\n  removeItem(key: string) {\n    this.store.delete(key);\n  }\n}\nconst memoryStorage = new MemoryStorage();\ninterface ICacheOptions {\n  storage: 'session' | 'local' | 'memory';\n  expire: number;\n}\n/**\n * 缓存指定id的数据, 存入storage\n * @param id 数据的在storage中储存时的key\n * @param initValue\n * @param opts\n */\nexport function useCache<T>(id: string, initValue: T, opts: Partial<ICacheOptions> = {}): [Ref<T>, (val: T) => T] {\n  const storage = opts.storage || 'session';\n  let store: Storage;\n  switch (storage) {\n    case 'local': store = localStorage; break;\n    case 'session': store = sessionStorage; break;\n    case 'memory': store = memoryStorage; break;\n    default: store = sessionStorage; break;\n  }\n  const expire = isUndefined(opts.expire) ? 0 : opts.expire;\n  const type = typeof initValue;\n  if (!legalType.includes(type)) {\n    throw new TypeError(`useCache: Illegal type <${type}> of ${id}.`);\n  }\n  const cache = store.getItem(PREFIX + id);\n  const lastModified = store.getItem(PREFIX + 'last-modified-' + id);\n  let data: Ref<T>;\n  if (cache !== null && (!expire || lastModified && Date.now() - new Date(lastModified).getTime() < expire)) {\n    if (type === 'object') {\n      try {\n        data = ref(JSON.parse(cache));\n      } catch (e) {\n        console.error(new SyntaxError(`In useCache: cache <${id}> is <${type}>, but JSON.parse cannot parse it correctly.`));\n        throw e;\n      }\n    } else {\n      data = ref(parseValueType(cache, type));\n    }\n  } else {\n    data = ref(initValue);\n  }\n  function update(val: T) {\n    let value: string;\n    if (type === 'object') {\n      value = val ? JSON.stringify(val) : '';\n    } else {\n      value = String(val);\n    }\n    store.setItem(PREFIX + id, value);\n    if (expire) {\n      store.setItem(PREFIX + 'last-modified-' + id, Date.now().toString());\n    }\n    data.value = val;\n    return val;\n  }\n  return [data, update];\n}\nfunction parseValueType(str: string, type: string) {\n  switch (type) {\n    case 'string':\n      return str;\n    case 'boolean':\n      return str === 'true' || false;\n    case 'number':\n      return Number(str);\n    default:\n      return str;\n  }\n}\n"],"sourceRoot":""}]}