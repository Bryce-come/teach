import { MessageBox } from 'element-ui';
import { Ref } from '@vue/composition-api';
import { AnyFunction } from '../types/common';

export function useLoading(loadingValue: Ref<boolean>, fn: AnyFunction) {
  // 环境变量不同
  // return useLoadingDirect(loadingValue.value, fn);
  return async function(this: any, ...rest: any[]) {
    loadingValue.value = true;
    try {
      await fn.apply(this, rest);
    } catch (e) {
      throw e;
    } finally {
      loadingValue.value = false;
    }
  };
}
export function useLoadingDirect(loadingValue: boolean, fn: AnyFunction) {
  return async function(this: any, ...rest: any[]) {
    loadingValue = true;
    try {
      await fn.apply(this, rest);
    } catch (e) {
      throw e;
    } finally {
      loadingValue = false;
    }
  };
}
export function useConfirm(msg: string, fn: AnyFunction) {
  return async function(this: any, ...rest: any[]) {
    try {
      await MessageBox.confirm(msg);
      fn.apply(this, rest);
    } catch {}
  };
}
